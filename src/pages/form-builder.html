<style>
.fb-container{display:grid;grid-template-columns:1fr 480px;gap:0;min-height:calc(100vh - 100px);background:#f4f6f8}
.fb-builder-panel{background:#fff;border-right:1px solid #e1e3e5;overflow-y:auto;padding:32px}
.fb-section{margin-bottom:32px}
.fb-section-title{font-size:16px;font-weight:700;margin-bottom:16px}
.fb-section-desc{color:#6b7280;font-size:14px;margin-bottom:16px}
.fb-form-types{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
.fb-form-type-card{border:2px solid #e1e3e5;border-radius:12px;padding:24px;cursor:pointer;text-align:center}
.fb-form-type-card:hover{border-color:#667eea;background:#f9fafb}
.fb-form-type-card.selected{border-color:#667eea;background:#f0f4ff}
.fb-form-type-icon{font-size:48px;margin-bottom:12px}
.fb-form-type-name{font-weight:700;margin-bottom:8px}
.fb-form-type-desc{font-size:13px;color:#6b7280}
.fb-input-group{margin-bottom:20px}
.fb-input-label{display:block;font-size:14px;font-weight:600;margin-bottom:8px}
.fb-input-field{width:100%;padding:10px 12px;border:1px solid #e1e3e5;border-radius:6px;font-size:14px}
.fb-input-field:focus{outline:none;border-color:#667eea}
.fb-field-item{background:#fff;border:1px solid #e1e3e5;border-radius:8px;padding:16px;display:flex;align-items:center;gap:12px;cursor:move;margin-bottom:12px}
.fb-field-item:hover{border-color:#667eea;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.fb-field-drag{color:#9ca3af;font-size:18px}
.fb-field-icon{width:36px;height:36px;background:#f0f4ff;color:#667eea;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px}
.fb-field-info{flex:1}
.fb-field-name{font-weight:600;margin-bottom:2px}
.fb-field-type{font-size:12px;color:#6b7280}
.fb-field-toggle{width:44px;height:24px;background:#e1e3e5;border-radius:12px;position:relative;cursor:pointer}
.fb-field-toggle.active{background:#667eea}
.fb-field-toggle::after{content:'';position:absolute;width:20px;height:20px;background:#fff;border-radius:50%;top:2px;left:2px;transition:left .3s}
.fb-field-toggle.active::after{left:22px}
.fb-preview-panel{background:#1a1a1a;padding:32px;overflow-y:auto}
.fb-preview-title{color:#fff;font-size:18px;font-weight:700;text-align:center;margin-bottom:24px}
.fb-phone-mockup{max-width:380px;margin:0 auto;background:#fff;border-radius:32px;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.fb-phone-notch{width:120px;height:24px;background:#1a1a1a;border-radius:0 0 16px 16px;margin:-20px auto 20px}
.fb-preview-form-header{text-align:center;padding:24px;border-bottom:1px solid #e1e3e5}
.fb-preview-form-title{font-size:20px;font-weight:700;margin-bottom:8px}
.fb-preview-form-desc{color:#6b7280;font-size:14px}
.fb-preview-fields{padding:24px}
.fb-preview-field{margin-bottom:20px}
.fb-preview-label{font-size:14px;font-weight:600;margin-bottom:8px;display:block}
.fb-preview-input{width:100%;padding:12px;border:1px solid #e1e3e5;border-radius:8px;font-size:14px}
.fb-preview-textarea{min-height:80px}
.fb-preview-submit{width:100%;padding:16px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:700;margin-top:24px}
.fb-btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:12px 24px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
.fb-alert{padding:16px;border-radius:8px;margin:20px 32px;display:none}
.fb-alert.success{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
.fb-alert.error{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
</style>

<div style="padding:20px 32px;background:#fff;border-bottom:1px solid #e1e3e5">
<h1 style="font-size:24px;font-weight:700;margin-bottom:8px">üìù Form Builder</h1>
<p style="color:#6b7280;font-size:14px">Create beautiful COD forms for your customers</p>
</div>

<div id="fb-alert" class="fb-alert"></div>

<div class="fb-container">
<div class="fb-builder-panel">
<div class="fb-section">
<div class="fb-section-title">Form Settings</div>
<div class="fb-input-group">
<label class="fb-input-label">Form Name</label>
<input type="text" class="fb-input-field" id="fb-form-name" value="Standard COD Form" placeholder="Enter form name">
</div>
<div class="fb-input-group">
<label class="fb-input-label">Form Description</label>
<input type="text" class="fb-input-field" id="fb-form-desc" placeholder="Brief description">
</div>
</div>

<div class="fb-section">
<div class="fb-section-title">Form Type</div>
<p class="fb-section-desc">Choose how the form displays</p>
<div class="fb-form-types">
<div class="fb-form-type-card selected" data-type="popup">
<div class="fb-form-type-icon">üì±</div>
<div class="fb-form-type-name">Pop-up Form</div>
<p class="fb-form-type-desc">Displays on page</p>
</div>
<div class="fb-form-type-card" data-type="embedded">
<div class="fb-form-type-icon">üìÑ</div>
<div class="fb-form-type-name">Embedded</div>
<p class="fb-form-type-desc">In page content</p>
</div>
</div>
</div>

<div class="fb-section">
<div class="fb-section-title">Form Fields</div>
<p class="fb-section-desc">Drag to reorder ‚Ä¢ Toggle to enable/disable</p>

<div id="fb-fields-list">
<div class="fb-field-item" draggable="true" data-field="name">
<span class="fb-field-drag">‚ãÆ‚ãÆ</span>
<div class="fb-field-icon">üë§</div>
<div class="fb-field-info">
<div class="fb-field-name">Customer Name</div>
<div class="fb-field-type">Text ‚Ä¢ Required</div>
</div>
<div class="fb-field-toggle active"></div>
</div>

<div class="fb-field-item" draggable="true" data-field="phone">
<span class="fb-field-drag">‚ãÆ‚ãÆ</span>
<div class="fb-field-icon">üìû</div>
<div class="fb-field-info">
<div class="fb-field-name">Phone Number</div>
<div class="fb-field-type">Phone ‚Ä¢ Required</div>
</div>
<div class="fb-field-toggle active"></div>
</div>

<div class="fb-field-item" draggable="true" data-field="email">
<span class="fb-field-drag">‚ãÆ‚ãÆ</span>
<div class="fb-field-icon">üìß</div>
<div class="fb-field-info">
<div class="fb-field-name">Email Address</div>
<div class="fb-field-type">Email ‚Ä¢ Optional</div>
</div>
<div class="fb-field-toggle"></div>
</div>

<div class="fb-field-item" draggable="true" data-field="address">
<span class="fb-field-drag">‚ãÆ‚ãÆ</span>
<div class="fb-field-icon">üìç</div>
<div class="fb-field-info">
<div class="fb-field-name">Delivery Address</div>
<div class="fb-field-type">Textarea ‚Ä¢ Required</div>
</div>
<div class="fb-field-toggle active"></div>
</div>

<div class="fb-field-item" draggable="true" data-field="city">
<span class="fb-field-drag">‚ãÆ‚ãÆ</span>
<div class="fb-field-icon">üèôÔ∏è</div>
<div class="fb-field-info">
<div class="fb-field-name">City</div>
<div class="fb-field-type">Text ‚Ä¢ Required</div>
</div>
<div class="fb-field-toggle active"></div>
</div>

<div class="fb-field-item" draggable="true" data-field="notes">
<span class="fb-field-drag">‚ãÆ‚ãÆ</span>
<div class="fb-field-icon">üìù</div>
<div class="fb-field-info">
<div class="fb-field-name">Order Notes</div>
<div class="fb-field-type">Textarea ‚Ä¢ Optional</div>
</div>
<div class="fb-field-toggle"></div>
</div>
</div>
</div>

<button class="fb-btn-primary" onclick="fbSaveForm()" style="width:100%;margin-top:20px">üíæ Save Form</button>
</div>

<div class="fb-preview-panel">
<div class="fb-preview-title">üì± Live Preview</div>

<div class="fb-phone-mockup">
<div class="fb-phone-notch"></div>

<div class="fb-preview-form-header">
<h3 class="fb-preview-form-title" id="fb-preview-title">Complete Your Order</h3>
<p class="fb-preview-form-desc" id="fb-preview-desc">Fill in the details below</p>
</div>

<div class="fb-preview-fields" id="fb-preview-fields">
<div class="fb-preview-field" data-field="name">
<label class="fb-preview-label">Customer Name *</label>
<input type="text" class="fb-preview-input" placeholder="Enter your name">
</div>

<div class="fb-preview-field" data-field="phone">
<label class="fb-preview-label">Phone Number *</label>
<input type="tel" class="fb-preview-input" placeholder="+1 (555) 000-0000">
</div>

<div class="fb-preview-field" data-field="email" style="display:none">
<label class="fb-preview-label">Email Address</label>
<input type="email" class="fb-preview-input" placeholder="you@example.com">
</div>

<div class="fb-preview-field" data-field="address">
<label class="fb-preview-label">Delivery Address *</label>
<textarea class="fb-preview-input fb-preview-textarea" placeholder="Enter full address"></textarea>
</div>

<div class="fb-preview-field" data-field="city">
<label class="fb-preview-label">City *</label>
<input type="text" class="fb-preview-input" placeholder="Enter city">
</div>

<div class="fb-preview-field" data-field="notes" style="display:none">
<label class="fb-preview-label">Order Notes</label>
<textarea class="fb-preview-input fb-preview-textarea" placeholder="Any special requests?"></textarea>
</div>

<button class="fb-preview-submit">üõí Place Order - Pay on Delivery</button>
</div>
</div>
</div>
</div>

<script>
document.querySelectorAll('.fb-form-type-card').forEach(c=>c.addEventListener('click',function(){document.querySelectorAll('.fb-form-type-card').forEach(x=>x.classList.remove('selected'));this.classList.add('selected')}));

document.querySelectorAll('.fb-field-toggle').forEach(t=>t.addEventListener('click',function(){this.classList.toggle('active');const f=this.closest('.fb-field-item').getAttribute('data-field');const p=document.querySelector(`.fb-preview-field[data-field="${f}"]`);if(p)p.style.display=this.classList.contains('active')?'block':'none'}));

document.getElementById('fb-form-name').addEventListener('input',e=>document.getElementById('fb-preview-title').textContent=e.target.value||'Complete Your Order');
document.getElementById('fb-form-desc').addEventListener('input',e=>document.getElementById('fb-preview-desc').textContent=e.target.value||'Fill in the details below');

let dragged=null;
document.querySelectorAll('.fb-field-item').forEach(i=>{
i.addEventListener('dragstart',function(){dragged=this;this.style.opacity='0.5'});
i.addEventListener('dragend',function(){this.style.opacity='1'});
i.addEventListener('dragover',e=>e.preventDefault());
i.addEventListener('drop',function(e){
e.preventDefault();
if(dragged!==this){
const c=this.parentNode;
const a=[...c.children];
const di=a.indexOf(dragged);
const ti=a.indexOf(this);
if(di<ti){c.insertBefore(dragged,this.nextSibling)}else{c.insertBefore(dragged,this)}
const pc=document.getElementById('fb-preview-fields');
document.querySelectorAll('.fb-field-item').forEach(x=>{
const fn=x.getAttribute('data-field');
const pf=document.querySelector(`.fb-preview-field[data-field="${fn}"]`);
if(pf)pc.appendChild(pf)
});
const sb=pc.querySelector('.fb-preview-submit');
if(sb)pc.appendChild(sb)
}
})
});

async function fbSaveForm(){
const d={
name:document.getElementById('fb-form-name').value,
description:document.getElementById('fb-form-desc').value,
type:document.querySelector('.fb-form-type-card.selected').getAttribute('data-type'),
fields:[],
active:true
};

document.querySelectorAll('.fb-field-item').forEach(i=>{
const t=i.querySelector('.fb-field-toggle');
if(t.classList.contains('active')){
const fn=i.getAttribute('data-field');
const fl=i.querySelector('.fb-field-name').textContent;
const ft=i.querySelector('.fb-field-type').textContent;
d.fields.push({name:fn,label:fl,type:ft,required:ft.includes('Required')})
}
});

if(!d.name){fbShowAlert('Please enter form name','error');return}
if(d.fields.length===0){fbShowAlert('Enable at least one field','error');return}

try{
const r=await fetch('/api/forms',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)});
if(r.ok){
fbShowAlert('‚úÖ Form saved successfully!','success');
setTimeout(()=>{if(confirm('Form saved! Create another?'))location.reload()},1500)
}else{
fbShowAlert('‚ùå Failed to save form','error')
}
}catch(e){
console.error(e);
fbShowAlert('‚ùå Network error','error')
}
}

function fbShowAlert(m,t){
const a=document.getElementById('fb-alert');
a.textContent=m;
a.className='fb-alert '+t;
a.style.display='block';
setTimeout(()=>a.style.display='none',5000)
}
</script>
